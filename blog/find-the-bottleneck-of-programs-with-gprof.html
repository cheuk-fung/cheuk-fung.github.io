<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <title>Find The Bottleneck of Programs with Gprof &larr; Blog</title>
        <meta name="author" content="Ng Cheuk-fung" />

        <link rel="start" href="/" />

        

        

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/files/css/syntax.css" type="text/css" />

        <!-- Homepage CSS -->
        <link rel="stylesheet" href="/files/css/screen.css" type="text/css" media="all" />
        <link rel="stylesheet" href="/files/css/print.css" type="text/css" media="print" />

        
    </head>
    <body id="">
        <div id="site">

            <div id="header">
    <h1>
    <a href="/blog">Blog</a>
    <span class="byline">&larr; <a href="/">The Stars My Destination</a></span>
</h1>
<ul class="nav">
    <li><a class="home" href="/">Home</a></li>
    <li><a class="info" href="/info">Info</a></li>
    <li><a class="code" href="/code">Code</a></li>
    <li><a class="past" href="/blog/past.html">Past</a></li>
</ul>

</div>


<div id="page">

    <h1 class="emphnext">Find The Bottleneck of Programs with Gprof</h1>

    <h2 id="whats-profiling">What’s Profiling</h2>

<blockquote>
  <p>In software engineering, profiling (“program profiling”, “software
profiling”) is a form of dynamic program analysis that measures, for
example, of space (memory) or time complexity of program, the usage of
particular instructions, or frequency and duration of function calls. The
most common use of profiling information is to aid program optimization.</p>
</blockquote>

<p style="text-align:right">
&#8212; via <a href="http://en.wikipedia.org/wiki/Software_performance_analysis">Wikipedia</a>
</p>

<h2 id="whats-gprof">What’s Gprof</h2>

<p>Gprof is a performance analyzing tool, aka, profiler, which can display call
graph profile data.</p>

<h2 id="usage-of-gprof">Usage of Gprof</h2>

<ol>
  <li>Compile the program using <code>gcc</code> with the <code>-pg</code> option.</li>
  <li>Run it and get a file named <code>gmon.out</code> containing dynamic call graph and
profile.</li>
  <li>Run <code>gprof ./program</code> to view the flat profile and call graph with detailed
explanation of each field.</li>
</ol>

<h2 id="visualization">Visualization</h2>

<p>To visualize the output of <code>gprof</code>, the following tools are recommended.</p>

<h3 id="gprof2dot"><a href="https://code.google.com/p/jrfonseca/wiki/Gprof2Dot">Gprof2Dot</a></h3>
<p>Convert profiling output to a dot graph.</p>

<h3 id="graphviz"><a href="http://www.graphviz.org">Graphviz</a></h3>
<p>A package of open-source tools for drawing graphs specified in DOT language
scripts.</p>

<p>I moved <code>gprof2dot.py</code> to <code>/usr/bin</code> as <code>gprof2dot</code> for convenient, therefore,
I can generate a png or many other format file by:</p>

<pre><code>gprof ./program | gprof2dot | dot -Tpng -o a.png
</code></pre>

<p>Additionally,</p>

<blockquote>
  <p>By default gprof2dot.py generates a partial call graph, excluding nodes and
edges with little or no impact in the total computation time. If you want
the full call graph then set a zero threshold for nodes and edges via the -n
/ –node-thres and -e / –edge-thres options, as:</p>
</blockquote>

<blockquote>
  <pre><code>gprof2dot.py -n0 -e0
</code></pre>
</blockquote>

<h2 id="what-about-memory-information">What About Memory Information</h2>

<p>Gprof can’t tell us about this. That’s why I need <a href="http://valgrind.org">Valgrind</a>, a suite of
tools for memory debugging, memory leak detection and profiling.</p>

<p>Memcheck is the default tool of Valgrind, so, to check memory usage and detect
memory leak, run:</p>

<pre><code>valgrind ./program
</code></pre>

<p>To run the other tools, cachegrind for instance:</p>

<pre><code>valgrind --tool=cachegrind ./program
</code></pre>

<p>And now, it’s not a big deal to find the bottleneck of programs.</p>


    <address class="signature">
        <a class="author" href="/">Ng Cheuk-fung</a> 
        <span class="date">22 November 2012</span>
        <span class="location">NKU, China</span>
    </address>
</div><!-- End Page -->
<!-- Disqus Comments -->
<div id="disqus_thread"></div>

<!-- Enable Disqus comments -->
<script type="text/javascript">
    var disqus_iframe_css = "leewings.github.io/files/css/screen.css";
    var disqus_title = "Find The Bottleneck of Programs with Gprof";
    var disqus_message = "A brief personal note on profiling.";
</script>
<script type="text/javascript" src="http://disqus.com/forums/cheuk-fung/embed.js"></script>

<noscript>
    <a href="http://cheuk-fung.disqus.com/?url=ref">View the discussion thread.</a>
</noscript>





            <div id="footer">
                <address>
                    <span class="copyright">
                        Content by 
                        <a href="/">Ng Cheuk-fung</a>
                        <br />
                        Original design by 
                        <a href="http://mark.reid.name/">Mark Reid</a>
                    </span>
                    <span class="engine">
                        Powered by 
                        <a href="https://github.com/mojombo/jekyll/" title="A simple, blog aware, static site generator">Jekyll</a>
                        <br/>
                        <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/3.0/80x15.png" /></a>
                    </span>
                </address>
            </div>
        </div>
    </body>
</html>
